<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/ReactNote/blog/rss.xml" title="React Note Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ReactNote/blog/atom.xml" title="React Note Blog Atom Feed"><title data-react-helmet="true">React Note</title><meta data-react-helmet="true" property="og:title" content="React Note"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react-hook-form/react-hook-form-summary"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" name="description" content="react-hook-form的设计思想"><meta data-react-helmet="true" property="og:description" content="react-hook-form的设计思想"><link data-react-helmet="true" rel="shortcut icon" href="/ReactNote/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react-hook-form/react-hook-form-summary"><link data-react-helmet="true" rel="alternate" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react-hook-form/react-hook-form-summary" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react-hook-form/react-hook-form-summary" hreflang="x-default"><link rel="stylesheet" href="/ReactNote/assets/css/styles.694d919f.css">
<link rel="preload" href="/ReactNote/assets/js/runtime~main.f75cb977.js" as="script">
<link rel="preload" href="/ReactNote/assets/js/main.af5c24bf.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ReactNote/"><img src="/ReactNote/img/logo.png" alt="React Note Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/ReactNote/img/logo.png" alt="React Note Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">React Note</b></a><a class="navbar__item navbar__link navbar__link--active" href="/ReactNote/docs/react/react/intro">React</a><a class="navbar__item navbar__link" href="/ReactNote/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/BUPTlhuanyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">react</a></li><li class="theme-doc-sidebar-item-category menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">react-hook-form</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ReactNote/docs/react/react-hook-form/react-hook-form-summary">源码解析</a></li><li class="theme-doc-sidebar-item-link menu__list-item"><a class="menu__link" tabindex="0" href="/ReactNote/docs/react/react-hook-form/react-hook-form-utils">utils</a></li></ul></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">react-router</a></li><li class="theme-doc-sidebar-item-category menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">react-transition</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1></h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="react-hook-form的设计思想"></a>react-hook-form的设计思想<a class="hash-link" href="#react-hook-form的设计思想" title="Direct link to heading">#</a></h2><p>一个表单，form标签下具备许多的子元素，每个子元素都具备输入的功能，在用户输入的过程中以及最终提交的过程中都可能会涉及到校验，这个校验的过程中会可能会发生校验失败等错误信息。对于这个表单的分析，需要提炼一下几个需要思考的关键点：</p><ul><li>字段以及对应的值如何管理</li><li>提交时候的校验与失焦校验如何实现</li><li>提交的时候校验到错误聚焦比较容易，但是滚动到对应的错误输入DOM会很艰难</li><li>为什么存在大量的手动重新渲染</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="字段以及对应的值如何管理"></a>🍀字段以及对应的值如何管理<a class="hash-link" href="#字段以及对应的值如何管理" title="Direct link to heading">#</a></h4><p>字段以及对应的值都会被存储在Ref中，由于Ref的变化不会导致组件的渲染，因此需要一个手动渲染的工具：<code>const [, render] = useState();</code>，这里每次都可以通过<code>render({})</code>来手动渲染组件。</p><p>0️⃣<strong>fieldsRef数据结构：</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    一些有关校验规则的选项</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ref: {name,...} // 一个DOM元素对应的ref引用</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}[]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>1️⃣<strong>注册：将字段保存到ref中</strong></p><p>这里通过register来注册每个字段，每个字段field在注册的时候，通过register，直接将字段名字存储在fieldsRef[field].ref.name上，比如：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input name=&quot;exampleRequired&quot; ref={register({ required: true })} /&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>这里fieldsRef[&#x27;exampleRequired&#x27;].ref是一个input这个DOM对应的ref，这个ref上name属性值为exampleRequired。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">register({ name: &quot;antDInput&quot; });</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>手动注册，这里的{ name: &quot;antDInput&quot; }存储在fieldsRef[&#x27;antDInput&#x27;].ref上。</p><p>2️⃣<strong>手动设置值setValue时候触发校验： 调用combineFieldValues</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">setValue: (name: string, value: any, shouldValidate?: boolean) =&gt; void</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>3️⃣<strong>手动获取值getValues时候触发校验： 调用combineFieldValues</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">getValues: (payload?: { nest: boolean }) =&gt; Object</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>4️⃣<strong>每个DOM上绑定的事件触发的时候触发校验： 调用combineFieldValues</strong></p><p>5️⃣<strong>提交校验： 调用combineFieldValues</strong></p><p>提交的时候进行校验，并将拼接成的form数据传入自当以的submit函数：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">handleSubmit: (data: Object, e: Event) =&gt; void</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="提交时候的校验与失焦校验如何实现"></a>🍀提交时候的校验与失焦校验如何实现<a class="hash-link" href="#提交时候的校验与失焦校验如何实现" title="Direct link to heading">#</a></h4><p>对于自动注册register：由于DOM对应的ref会被保存下来，因此失焦或者实时校验会通过为DOM添加事件监听函数来实现，并每次DOM的value的值变化的时候，对应的ref中的值也是动态变化的。而提交的时候，可以从保存的各个ref中将数据搜集起来用于校验与提交。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;input name=&quot;exampleRequired&quot; ref={register({ required: true })} /&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>对于手动注册register：由于DOM对应的ref无法保存，因此需要调用手动设置值的方式setValue来更新DOM上变化的值，以及实时校验这个变化的值。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">register({ name: &#x27;test&#x27; }, { required: true, min: 2 })</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;button type=&quot;button&quot; onClick={() =&gt; {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // manually set the &#x27;test&#x27; field with value &#x27;bill&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    setValue(&#x27;test&#x27;, &#x27;bill&#x27;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}}&gt;SetValue&lt;/button&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="提交的时候校验到错误聚焦比较容易但是滚动到对应的错误输入dom会很艰难"></a>🍀提交的时候校验到错误聚焦比较容易，但是滚动到对应的错误输入DOM会很艰难<a class="hash-link" href="#提交的时候校验到错误聚焦比较容易但是滚动到对应的错误输入dom会很艰难" title="Direct link to heading">#</a></h4><p>在手动注册的时候，由于无法将DOM元素的ref保存下来，因此无法在提交的时候自动聚焦到校验失败的第一个DOM元素，但是自动注册由于保存了DOM的ref，因此可以自动聚焦。但是自动聚焦并且滚动到对应的位置还需要写对应的逻辑。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="为什么存在大量的手动重新渲染"></a>🍀为什么存在大量的手动重新渲染<a class="hash-link" href="#为什么存在大量的手动重新渲染" title="Direct link to heading">#</a></h4><p>在设置值setValue的时候，因为这些value存储在ref中，因此每次改变都不会重渲染，因此每次setValue都需要手动渲染</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/BUPTlhuanyu/ReactNote/tree/master/docs/react/react-hook-form/源码解析.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ReactNote/docs/react/react/error/error-handle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« 如何处理错误</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ReactNote/docs/react/react-hook-form/react-hook-form-utils"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">utils »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#react-hook-form的设计思想" class="table-of-contents__link">react-hook-form的设计思想</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 BUPTlhuanyu, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ReactNote/assets/js/runtime~main.f75cb977.js"></script>
<script src="/ReactNote/assets/js/main.af5c24bf.js"></script>
</body>
</html>