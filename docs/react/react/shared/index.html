<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-react/react/shared/shared">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.18">
<link rel="alternate" type="application/rss+xml" href="/ReactNote/blog/rss.xml" title="React Note RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ReactNote/blog/atom.xml" title="React Note Atom Feed"><title data-rh="true">React Note</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react/shared"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="description" content="目录结构"><meta data-rh="true" property="og:description" content="目录结构"><link data-rh="true" rel="icon" href="/ReactNote/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react/shared"><link data-rh="true" rel="alternate" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react/shared" hreflang="en"><link data-rh="true" rel="alternate" href="https://BUPTlhuanyu.github.io/ReactNote/docs/react/react/shared" hreflang="x-default"><link rel="stylesheet" href="/ReactNote/assets/css/styles.5bb7972e.css">
<link rel="preload" href="/ReactNote/assets/js/runtime~main.208fed75.js" as="script">
<link rel="preload" href="/ReactNote/assets/js/main.d0834552.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?64a3c7fa9e8533c72827dc22e0d273ab";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ReactNote/"><div class="navbar__logo"><img src="/ReactNote/img/logo.png" alt="React Note Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/ReactNote/img/logo.png" alt="React Note Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">React Note</b></a><a class="navbar__item navbar__link" href="/ReactNote/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/BUPTlhuanyu" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/ReactNote/docs/react/react/intro">react</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ReactNote/docs/react/react/intro">介绍</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ReactNote/docs/react/react/project-directory">目录结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/ReactNote/docs/react/react/shared">公共方法</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ReactNote/docs/react/react/ReactElement/reactelement-and-children">ReactElement</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ReactNote/docs/react/react/scheduler/why-need-scheduler">scheduler</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ReactNote/docs/react/react/reconciler/container-root">reconciler</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/ReactNote/docs/react/react/event/event-bind">event</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/ReactNote/docs/react/react/error/error-handle">如何处理错误</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ReactNote/docs/react/react-hook-form/react-hook-form-summary">react-hook-form</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ReactNote/docs/react/react-router/react-router-summary">react-router</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/ReactNote/docs/react/react-transition/react-transition-group-transition">react-transition</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/ReactNote/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">react</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">公共方法</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1></h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="目录结构">目录结构<a class="hash-link" href="#目录结构" title="Direct link to heading">​</a></h2><div class="codeBlockContainer_I0IT language-json theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-json codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">shared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————错误处理———</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ invariant.js                 </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：格式化输出错误</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ reactProdInvariant.js        </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：封装 invariant</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ lowPriorityWarning.js        </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：封装 console.warn</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ warningWithoutStack.js       </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：封装 console.error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ warning.js                   </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：输出发生错误的组件层级信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ describeComponentFrame.js    </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：错误信息来源于babel-transform -react-jsx</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ invokeGuardedCallbackImpl.js </span><span class="token comment" style="color:#999988;font-style:italic">// 错误处理：收集 error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————ReactElement与fiber———</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactElementType.js          </span><span class="token comment" style="color:#999988;font-style:italic">// ReactElement 通用属性类型定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactSymbols.js              </span><span class="token comment" style="color:#999988;font-style:italic">// ReactElement $$typeof 属性定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactTypes.js                </span><span class="token comment" style="color:#999988;font-style:italic">// 各种ReactElement类型（$$typeof）的属性定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactLazyComponent.js        </span><span class="token comment" style="color:#999988;font-style:italic">// ReactLazyComponent 属性定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactPortal.js               </span><span class="token comment" style="color:#999988;font-style:italic">// ReactPortal 属性定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ isValidElementType.js        </span><span class="token comment" style="color:#999988;font-style:italic">// 判断是否是一个ReactElement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactInstanceMap.js          </span><span class="token comment" style="color:#999988;font-style:italic">// 提供方法将ReactElement与其fiber关联起来</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactWorkTags.js             </span><span class="token comment" style="color:#999988;font-style:italic">// Fiber.tag 属性值，表示该fiber的类型，即对应哪种react实例</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ getComponentName.js          </span><span class="token comment" style="color:#999988;font-style:italic">// 获取组件名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————fiber的操作————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ getParent.js                 </span><span class="token comment" style="color:#999988;font-style:italic">// 获取父fiber</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ getParentInstance.js         </span><span class="token comment" style="color:#999988;font-style:italic">// 同上，就是换了名字</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ getLowestCommonAncestor.js   </span><span class="token comment" style="color:#999988;font-style:italic">// 获取最低公共祖先</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ isAncestor.js                </span><span class="token comment" style="color:#999988;font-style:italic">// 判断A是否是B的祖宗</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ traverseTwoPhase.js          </span><span class="token comment" style="color:#999988;font-style:italic">// 模拟冒泡捕获</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ traverseEnterLeave.js        </span><span class="token comment" style="color:#999988;font-style:italic">// 模拟移除进入事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————标记需要对fiber执行什么类型的操作————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ ReactSideEffectTags.js       </span><span class="token comment" style="color:#999988;font-style:italic">// 熟悉的有 Replace，deletion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————比较————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ areHookInputsEqual.js        </span><span class="token comment" style="color:#999988;font-style:italic">// 比较两数组是一样：比较hook传入的数组是否是一样的</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├─ shallowEqual.js              </span><span class="token comment" style="color:#999988;font-style:italic">// 浅比较：Object.is，hasOwnProperty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">————其他，忽略————</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─ *</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="错误处理">错误处理<a class="hash-link" href="#错误处理" title="Direct link to heading">​</a></h2><p>​	在使用<code>react</code>的过程中，如果报错，经常会看到某个错误发生在哪个组件文件中，详细到组件文件的行数与列数，这些错误信息挂载在<code>react</code> 实例(<code>ReactElement</code>)的<code>_source</code>这样的属性上，错误信息是由<code>babel</code>生产的，原理是编译时<code>babel-transform -react-jsx</code>在将 <code>jsx</code>解析成<code>createElement</code>调用形式，而<code>createElement</code>接收到的第二个参数则包含了<code>_source</code>属性，<code>createElement</code>在后面章节会讲到，主要创建一个<code>react</code> 实例。<code>_source</code>如下：</p><p><img loading="lazy" alt="fiber" src="/ReactNote/assets/images/_source-f7c256a56cc054c9762a5459b3dc35e1.png" width="1354" height="196" class="img_E7b_"></p><p>​	还有一点需要注意，<code>invokeGuardedCallbackImpl.js</code>会收集用户外部函数的错误信息(<code>Error</code>实例)，在生产环境下主要由<code>try...catch</code>实现，在 <code>try</code>中会执行涉及用户传入函数(<code>user-provided function</code> )的函数，（比如<code>workLopp</code>，即用于循环协调组件的函数，在协调过程则会执行组件的生命周期钩子函数）。</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invokeGuardedCallbackImpl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">func</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">context</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">e</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> funcArgs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token class-name">Array</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">slice</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">call</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">arguments</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    func</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcArgs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>在开发环境中，则模拟了一个 <code>try...catch</code>代码块，原理是替换掉 <code>window</code> 上的 <code>error</code> 事件监听函数，然后创建一个<code>DOM</code>，接着自定义一个事件并在创建的 <code>DOM</code> 上绑定事件处理函数，同步触发自定义事件，事件处理函数中执行包含<code>user-provided function</code>的代码，如果报错了，那么<code> error</code> 事件监听函数会执行，并收集错误。错误系统在<code>react</code>中是非常重要的一块，</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">invokeGuardedCallbackImpl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">name</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">func</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">context</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">a</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">b</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">c</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">d</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">e</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter">f</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> evt </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token dom variable" style="color:#36acaa">document</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Event&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> didError </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">callCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token method function property-access" style="color:#d73a49">func</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">apply</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> funcArgs</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        didError </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> error</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> didSetError </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> isCrossOriginError </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">handleWindowError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">event</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token comment" style="color:#999988;font-style:italic">// 设置一下 error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> evtType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c">react-</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">${</span><span class="token template-string interpolation">name </span><span class="token template-string interpolation operator" style="color:#393A34">?</span><span class="token template-string interpolation"> name </span><span class="token template-string interpolation operator" style="color:#393A34">:</span><span class="token template-string interpolation"> </span><span class="token template-string interpolation string" style="color:#e3116c">&#x27;invokeguardedcallback&#x27;</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:#393A34">}</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleWindowError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fakeNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">addEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evtType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> callCallback</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      evt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">initEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evtType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      fakeNode</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">dispatchEvent</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">evt</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">didError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">didSetError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword control-flow" style="color:#00009f">else</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">isCrossOriginError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">error </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;...&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">onError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token dom variable" style="color:#36acaa">window</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">removeEventListener</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;error&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> handleWindowError</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>对于<code>react</code>的错误处理系统，这里暂时忽略，后续会等系列结束之后以一个附录补充，当然如果有好的文章，欢迎在评论贴出，目前先回到主线。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="组件相关">组件相关<a class="hash-link" href="#组件相关" title="Direct link to heading">​</a></h2><blockquote><p>在开始之前需要有一定的概念，JSX --&gt; ReactElement --&gt; Fiber --&gt; 视图，react在将jsx生成对应的ReactElement之后会据此生成一个fiber，ReactElement上的生命周期钩子产生的更新修改的是这个fiber上的数据，因此可以看出fiber其实可以当成一个数据容器，保存了该fiber当前的状态，当某个时间点fiber的数据更新完成之后，react会将该fiber的数据渲染到视图上。从这里可以看到react中数据的分层结构，ReactElement是最贴近开发者这一层的，对外接受生命周期钩子。fiber则是react底层数据容器，fiber直接影响的dom则是页面用户侧。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="reactelementtypejs">ReactElementType.js<a class="hash-link" href="#reactelementtypejs" title="Direct link to heading">​</a></h3><p>只列出开发环境存在的属性，可以看到这里有一些非常熟悉的属性<code>key,ref,props</code>，<code>_owner</code>则是该组件标签所在的组件对应的ReactElement。下面简单介绍一下 <code>type</code> 属性以及<code>$$typeof</code>，后续专门介绍 <code>createElement</code>函数如何构建一个 <code>ReactElement</code> 。</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> type </span><span class="token maybe-class-name">ReactElement</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  $$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// </span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">key</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">ref</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">props</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">_owner</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> any</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ReactInstance or ReactFiber</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="type">type<a class="hash-link" href="#type" title="Direct link to heading">​</a></h4><blockquote><p><code>type</code> 表示的是这个<code>ReactElement</code>的行为</p></blockquote><p>在调用 <code>createElement</code> 创建 <code>ReactElement</code> 的时候，传入的第一个参数为 <code>type</code> 属性的值，如果是字符串比如<code>&#x27;div&#x27;</code>，则表示该<code>react</code>实例对应一个真实的<code>dom</code>；如果是一个函数，则表示一个函数/类组件；</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">FnType</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;div&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">Content</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">f</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">a</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">createElement</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token maybe-class-name">ClassType</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>也可能是一个对象(<code>typeof  === &#x27;object&#x27;</code>)，比如 <code>Context.Provider</code>，<code>Context.Consumer</code>，<code>React.lazy</code>，<code>React.forwardRef</code>，<code>React.memo</code></p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Context.Provider</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  $$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">react</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">provider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">_context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">react</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">Consumer</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">react</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">context</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">_context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">…</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">_calculateChangedBits</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> …</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">Provider</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">$$</span><span class="token keyword" style="color:#00009f">typeof</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token known-class-name class-name">Symbol</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">react</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">provider</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">_context</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">…</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="typeof">$$typeof<a class="hash-link" href="#typeof" title="Direct link to heading">​</a></h4><blockquote><p><code>$$typeof</code> 表示的是这个<code>ReactElement</code>的类型</p></blockquote><p>对于 <code>$$typeof</code>，在<code>ReactSymbols.js</code>中可以找到其值：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_ELEMENT_TYPE = hasSymbol ? Symbol.for(&#x27;react.element&#x27;): 0xeac7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_PORTAL_TYPE = hasSymbol? Symbol.for(&#x27;react.portal&#x27;): 0xeaca;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_FRAGMENT_TYPE = hasSymbol? Symbol.for(&#x27;react.fragment&#x27;): 0xeacb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_STRICT_MODE_TYPE = hasSymbol? Symbol.for(&#x27;react.strict_mode&#x27;): 0xeacc;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_PROFILER_TYPE = hasSymbol? Symbol.for(&#x27;react.profiler&#x27;): 0xead2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_PROVIDER_TYPE = hasSymbol? Symbol.for(&#x27;react.provider&#x27;): 0xeacd;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_CONTEXT_TYPE = hasSymbol? Symbol.for(&#x27;react.context&#x27;): 0xeace;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_ASYNC_MODE_TYPE = hasSymbol? Symbol.for(&#x27;react.async_mode&#x27;): 0xeacf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_CONCURRENT_MODE_TYPE = hasSymbol? Symbol.for(&#x27;react.concurrent_mode&#x27;): 0xeacf;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_FORWARD_REF_TYPE = hasSymbol? Symbol.for(&#x27;react.forward_ref&#x27;): 0xead0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_SUSPENSE_TYPE = hasSymbol? Symbol.for(&#x27;react.suspense&#x27;): 0xead1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_MEMO_TYPE = hasSymbol ? Symbol.for(&#x27;react.memo&#x27;) : 0xead3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export const REACT_LAZY_TYPE = hasSymbol ? Symbol.for(&#x27;react.lazy&#x27;) : 0xead4;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="reactinstancemapjs">ReactInstanceMap.js<a class="hash-link" href="#reactinstancemapjs" title="Direct link to heading">​</a></h3><p>提供方法将<code>ReactElement</code>与其<code>fiber</code>关联起来，比如给组件实例的 <code>_reactInternalFiber</code> 属性 <code>remove/get/has/set</code> 组件实例对应的 fiber 对象。</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="reactworktagsjs">ReactWorkTags.js<a class="hash-link" href="#reactworktagsjs" title="Direct link to heading">​</a></h3><p><code>Fiber.tag</code> 属性值，表示该<code>fiber</code>的类型，即对应哪种<code>react</code>实例，比如<code> fiber.tag</code> 为 <code>0</code> 表示该 <code>fiber</code> 对应的组件是一个函数组件。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="标记需要对fiber执行什么类型的操作">标记需要对fiber执行什么类型的操作<a class="hash-link" href="#标记需要对fiber执行什么类型的操作" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="reactsideeffecttagsjs">ReactSideEffectTags.js<a class="hash-link" href="#reactsideeffecttagsjs" title="Direct link to heading">​</a></h3><p>对<code>fiber</code>需要进行什么操作的标志</p><div class="codeBlockContainer_I0IT language-javascript theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-javascript codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">NoEffect</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*              */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 这个fiber啥都不要干</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">PerformedWork</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*         */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000000001</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// react devtools相关的，忽略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// You can change the rest (and add more).</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Placement</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*             */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000000010</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 表示dom需要替换</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Update</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*                */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000000100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 表示dom需要更新属性</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">PlacementAndUpdate</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*    */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000000110</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 替换以及更新</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Deletion</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*              */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000001000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// dom需要删除</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">ContentReset</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*          */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000010000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// dom的文本内容需要重置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Callback</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*              */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000000100000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// setState有回调要执行</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">DidCapture</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*            */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000001000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 有组件suspended，需要挂在对应的组件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Ref</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*                   */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000010000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 需要更新 ref</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Snapshot</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*              */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b000100000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 表示在渲染dom之前需要执行getSnapshotBeforeUpdate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Passive</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*               */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b001000000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 副作用</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Passive &amp; Update &amp; Callback &amp; Ref &amp; Snapshot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">LifecycleEffectMask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*   */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b001110100100</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Union of all host effects</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">HostEffectMask</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*        */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b001111111111</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">Incomplete</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*            */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b010000000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 发生错误中断了，组件还没协调完的标记</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token maybe-class-name">ShouldCapture</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/*         */</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0b100000000000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 回滚使suspend组件处于初始状态，卸载fallback组件</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="fiber-的操作">fiber 的操作<a class="hash-link" href="#fiber-的操作" title="Direct link to heading">​</a></h2><blockquote><p>Fiber.return 表示该节点的父节点</p><p>Ifber.alternate 表示当前fiber对应的老的fiber节点，这里设计双缓冲fiber树，暂不介绍</p></blockquote><h4 class="anchor anchorWithStickyNavbar_mojV" id="getparent">getParent<a class="hash-link" href="#getparent" title="Direct link to heading">​</a></h4><p>在<code>fiber</code>树中获取当前实例节点的父节点实例（该父节点对应的只能是真实<code>DOM</code>，不能是<code>text</code>或者类组件或者函数组件等等）。</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">//HostComponent组件对应的DOM，比如App的tag=3, 表示为类组件，其child为tag=5对应div元素。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function getParent(inst) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  do {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inst = inst.return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  } while (inst &amp;&amp; inst.tag !== HostComponent);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (inst) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return inst;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="getlowestcommonancestor">getLowestCommonAncestor<a class="hash-link" href="#getlowestcommonancestor" title="Direct link to heading">​</a></h4><p>获取节点<code>A</code>与<code>B</code>的最近的公共祖先节点</p><p>简单算法题：找到两个链表的公共节点</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export function getLowestCommonAncestor(instA, instB) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //获取子节点A在树中的深度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let depthA = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (let tempA = instA; tempA; tempA = getParent(tempA)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    depthA++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //获取子节点B在树中的深度</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let depthB = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (let tempB = instB; tempB; tempB = getParent(tempB)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    depthB++;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If A is deeper, crawl up.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 如果A的深度高，那么A节点先往上走depthA - depthB个节点，最后同时走，直到父节点是同一个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (depthA - depthB &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instA = getParent(instA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    depthA--;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 如果B的深度高，那么B节点先往上走depthB - depthB个节点，最后同时走，直到父节点是同一个</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // If B is deeper, crawl up.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (depthB - depthA &gt; 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instB = getParent(instB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    depthB--;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Walk in lockstep until we find a match.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 现在，指针所处的位置的高度一致，可以同时往上查找，直到找到公共的节点</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let depth = depthA;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (depth--) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (instA === instB || instA === instB.alternate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return instA;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instA = getParent(instA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instB = getParent(instB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="isancestor">isAncestor<a class="hash-link" href="#isancestor" title="Direct link to heading">​</a></h4><p>判断<code>A</code>节点是否是<code>B</code>节点的祖先节点</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export function isAncestor(instA, instB) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (instB) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (instA === instB || instA === instB.alternate) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    instB = getParent(instB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="getparentinstance">getParentInstance<a class="hash-link" href="#getparentinstance" title="Direct link to heading">​</a></h4><p>对<code>getParent</code>的<code>export</code>封装：</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export function getParentInstance(inst) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return getParent(inst);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="traversetwophase">traverseTwoPhase<a class="hash-link" href="#traversetwophase" title="Direct link to heading">​</a></h4><p>对<code>fiber</code>及其以上的树执行冒泡捕获的操作，执行<code>fn</code>。类似事件的冒泡捕获</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export function traverseTwoPhase(inst, fn, arg) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const path = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //将inst的父节点入栈，数组最后的为最远的祖先</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (inst) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    path.push(inst);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inst = getParent(inst);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  let i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //从最远的祖先开始向inst节点捕获执行fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (i = path.length; i-- &gt; 0; ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn(path[i], &#x27;captured&#x27;, arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //从inst节点开始向最远的祖先节点冒泡执行fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (i = 0; i &lt; path.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn(path[i], &#x27;bubbled&#x27;, arg);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="traverseenterleave">traverseEnterLeave<a class="hash-link" href="#traverseenterleave" title="Direct link to heading">​</a></h4><p>当关注点从<code>from</code>节点移出然后移入<code>to</code>节点的时候,在<code>from</code>执行执行类似移入移出的操作</p><p><code>Fiber</code> 树如下如下：</p><p><img loading="lazy" alt="fiber" src="data:image/png;base64,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" width="226" height="286" class="img_E7b_"></p><p>上述过程，当执行<code>traverseEnterLeave(E, B, fn, argFrom, argTo)</code>函数的时候，类似鼠标从节点<code>from</code>(即E节点)移入到节点<code>to</code>(即B节点)，这个时候会依次调用</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">fn(E, &#x27;bubbled&#x27;, argFrom) --&gt; fn(C, &#x27;bubbled&#x27;, argFrom) --&gt; fn(B, &#x27;captured&#x27;, argTo)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><p>这样的一个过程是从节点<code>E</code>冒泡到最低公共祖先节点<code>A</code>然后向下捕获直到节点<code>B</code>。过程中会依次调用<code>fn</code>。但是不会对最低公共祖先节点执行<code>fn</code></p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">export function traverseEnterLeave(from, to, fn, argFrom, argTo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const common = from &amp;&amp; to ? getLowestCommonAncestor(from, to) : null;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const pathFrom = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!from) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (from === common) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const alternate = from.alternate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (alternate !== null &amp;&amp; alternate === common) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pathFrom.push(from);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    from = getParent(from);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const pathTo = [];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  while (true) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (!to) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (to === common) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    const alternate = to.alternate;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (alternate !== null &amp;&amp; alternate === common) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      break;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pathTo.push(to);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    to = getParent(to);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //以上代码将from节点到from与to节点的最近公共祖先节点（不包括公共祖先节点）push到pathFrom数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //以上代码将to节点到from与to节点的最近公共祖先节点（不包括公共祖先节点）push到pathTo数组</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // 以下代码用于对pathFrom冒泡，执行fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (let i = 0; i &lt; pathFrom.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn(pathFrom[i], &#x27;bubbled&#x27;, argFrom);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 以下代码用于对pathTo捕获，执行fn</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (let i = pathTo.length; i-- &gt; 0; ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    fn(pathTo[i], &#x27;captured&#x27;, argTo);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="比较">比较<a class="hash-link" href="#比较" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="shallowequaljs">shallowEqual.js<a class="hash-link" href="#shallowequaljs" title="Direct link to heading">​</a></h3><p>浅比较</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx" style="color:#393A34;background-color:#f6f8fa"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">const hasOwnProperty = Object.prototype.hasOwnProperty;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function shallowEqual(objA: mixed, objB: mixed): boolean {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (is(objA, objB)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值都是 undefined</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值都是 null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值都是 true 或者都是 false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值是由相同个数的字符按照相同的顺序组成的字符串</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值指向同一个对象</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      // 两个值都是数字并且</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 都是正零 +0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 都是负零 -0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 都是 NaN</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 都是除零和 NaN 外的其它同一个数字</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    typeof objA !== &#x27;object&#x27; || objA === null || typeof objB !== &#x27;object&#x27; ||objB === null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //objA与objB有一个不是对象或者有一个是null，则返回不相等。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 处理两个对象的情况</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const keysA = Object.keys(objA);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const keysB = Object.keys(objB);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (keysA.length !== keysB.length) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Test for A&#x27;s keys different from B.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (let i = 0; i &lt; keysA.length; i++) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      !hasOwnProperty.call(objB, keysA[i]) ||</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      !is(objA[keysA[i]], objB[keysA[i]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return false;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return true;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" title="Copy" class="copyButton_eDfN clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="arehookinputsequaljs">areHookInputsEqual.js<a class="hash-link" href="#arehookinputsequaljs" title="Direct link to heading">​</a></h3><p><code>areHookInputsEqual</code>判断两个数组是否相等，基于<code> Object.is</code>。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>​	本节简单的介绍了react 中进行错误处理的一些工具函数，这是一个非常值得深究的问题，但是不是作为本章的内容，鉴于目前没找到相关写<code>react error system</code> 的文章，这一部分放到系列结束再来讲。其次简单介绍了<code>ReactElement</code>的数据结构，并详细的介绍了两个属性<code>type</code>以及<code>$$typeof</code>，前者为<code>ReactElement</code>具体的行为，后者为<code>ReactElement</code>的类型。其次介绍了<code>ReactElement</code>与<code>fiber</code>是如何关联起来的，但是并没有介绍后者的数据结构，以及两者之间是如何的关系，后续章节会说到，这里只需要记住后者的&#x27;原料&#x27;是前者，前者贴近<code>react</code>开发者，后者是前者的状态数据容器，直接影响表现层(<code>view</code>)的<code>dom</code>。然后还介绍了<code>fiber</code>的一些操作，其实这些操作可以看成一个事件系统的必备函数。接着介绍了<code>react</code>如何对<code>fiber</code>操作的一些标记。最后介绍了一些比较的方法。</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="课后练习">课后练习<a class="hash-link" href="#课后练习" title="Direct link to heading">​</a></h2><p>如何实现一个事件系统？</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/BUPTlhuanyu/ReactNote/tree/master/docs/react/react/shared/shared.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/ReactNote/docs/react/react/project-directory"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">目录结构</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/ReactNote/docs/react/react/ReactElement/reactelement-and-children"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">ReactElement以及Children</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#目录结构" class="table-of-contents__link toc-highlight">目录结构</a></li><li><a href="#错误处理" class="table-of-contents__link toc-highlight">错误处理</a></li><li><a href="#组件相关" class="table-of-contents__link toc-highlight">组件相关</a><ul><li><a href="#reactelementtypejs" class="table-of-contents__link toc-highlight">ReactElementType.js</a></li><li><a href="#reactinstancemapjs" class="table-of-contents__link toc-highlight">ReactInstanceMap.js</a></li><li><a href="#reactworktagsjs" class="table-of-contents__link toc-highlight">ReactWorkTags.js</a></li></ul></li><li><a href="#标记需要对fiber执行什么类型的操作" class="table-of-contents__link toc-highlight">标记需要对fiber执行什么类型的操作</a><ul><li><a href="#reactsideeffecttagsjs" class="table-of-contents__link toc-highlight">ReactSideEffectTags.js</a></li></ul></li><li><a href="#fiber-的操作" class="table-of-contents__link toc-highlight">fiber 的操作</a></li><li><a href="#比较" class="table-of-contents__link toc-highlight">比较</a><ul><li><a href="#shallowequaljs" class="table-of-contents__link toc-highlight">shallowEqual.js</a></li><li><a href="#arehookinputsequaljs" class="table-of-contents__link toc-highlight">areHookInputsEqual.js</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#课后练习" class="table-of-contents__link toc-highlight">课后练习</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 BUPTlhuanyu, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/ReactNote/assets/js/runtime~main.208fed75.js"></script>
<script src="/ReactNote/assets/js/main.d0834552.js"></script>
</body>
</html>